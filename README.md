# 스마트 양식장 수온 예측 시스템
## 1. 프로젝트 개요
본 프로젝트는 여러 양식장의 각기 다른 수조에서 수집되는 대용량 시계열 데이터를 분석하여, 미래의 수온을 예측하는 파이썬 기반 시스템입니다. 복잡하고 노이즈가 많은 원본 데이터를 정제하고, Prophet 모델을 활용하여 사용자가 원하는 주기(일/주/월)별로 미래 7개 기간의 수온과 불확실성 구간을 예측합니다.  
  
최종 예측 결과는 다른 시스템에서 쉽게 활용할 수 있도록 표준화된 `JSON` 형식으로 저장됩니다.

## 2. 핵심 기능 및 알고리즘
### 2.1. 대용량 데이터 처리 (Chunk Processing)
- **문제점**: 수십 GB에 달하는 원본 CSV 파일은 메모리에 한 번에 로드할 수 없습니다.

- **해결책**: Pandas의 `chunksize` 옵션을 사용하여 파일을 작은 덩어리로 나누어 처리합니다. `usecols` 파라미터를 함께 사용하여 필요한 컬럼(`wt`, `fclty_id`, `collect_de`, `collect_time`)만 읽어와 메모리 사용량을 최적화합니다.

### 2.2. 2단계 이상치 정제 파이프라인
- **1차 (동적 필터링)**: 이전 측정값과 비교하여 비정상적인 급등/급락(예: 1시간 내 5℃ 이상 변화) 데이터를 감지하고 제거합니다.

- **2차 (정적 필터링)**: 물리적으로 불가능한 절대 온도 범위(예: 5℃ 미만, 30℃ 초과)를 벗어나는 데이터를 제거합니다.

### 2.3. 마스터 데이터 생성
- 목표: 개별 센서의 오류에 영향을 받지 않는, 각 양식장 위치를 대표하는 단일 시계열 데이터를 생성합니다.

- 방법:  
1. 정제된 데이터를 '시설 코드'(ID의 앞 5자리)로 그룹핑합니다.  
2. 각 그룹을 일별(Daily) 주기로 리샘플링하고, 각 날짜의 대표값으로 
**중앙값**(`median`)을 사용합니다.  
3. 데이터가 없는 날은 보간(`interpolate`)을 통해 채워 끊김 없는 데이터를 만듭니다.

### 2.4. 다중 주기 예측 (Multi-horizon Forecasting)
- **목표**: 사용자의 필요에 따라 다양한 시간 단위의 예측을 제공합니다.

- **방법**:  
1. 일별 마스터 데이터를 예측 단위('D', 'W', 'M')에 맞춰 다시 리샘플링합니다.  
2. 각 단위별로 불완전한 마지막 기간(오늘, 이번 주, 이번 달)의 데이터는 학습에서 제외하여 예측의 정확도를 높입니다.  
3. 각각의 리샘플링된 데이터로 독립된 Prophet 모델을 학습시키고, 미래 7개 기간을 예측합니다.

### 2.5. 예측 기준일 동기화
- **문제점**: 시설마다 데이터의 마지막 수집일이 달라 예측 시작일이 제각각일 수 있습니다.

- **해결책**: 데이터의 마지막 날짜와 상관없이, **코드가 실행되는** '**오늘**'을 기준으로 과거 데이터를 학습하고 미래를 예측합니다.   
이를 위해 학습 데이터에 빈 기간을 명시적으로 추가하여 모델이 '현재'가 어디인지 인지하도록 합니다.

## 3. 시스템 실행 방법
본 스크립트는 명령줄 인터페이스(CLI)를 통해 실행됩니다.

### 3.1. 필수 라이브러리 설치
실행 전, 아래 라이브러리들이 설치되어 있어야 합니다.
<pre>
pip install pandas numpy prophet matplotlib
</pre>

### 3.2. 실행 명령어
터미널에서 아래와 같이 명령어를 실행합니다.
<pre>
python main.py --path <데이터_폴더_경로> [--unit <예측_단위>]
</pre>
#### 인자(Arguments) 설명
- `--path` (필수): `raw_data.csv` 파일이 위치한 폴더의 경로를 지정합니다.

- `--unit` 또는 `-u` (선택): 예측을 실행할 단위를 'D'(일), 'W'(주), 'M'(월) 중에서 하나만 지정합니다. 이 인자를 생략하면 모든 단위(D, W, M)에 대해 예측을 수행합니다.

#### 실행 예시
<pre>
# 모든 단위(일, 주, 월)에 대해 예측 실행
python main.py --path /data/farm_data

# 주(Weekly) 단위로만 예측 실행
python main.py --path /data/farm_data --unit W
</pre>
## 4. 최종 출력
스크립트 실행이 완료되면, ``--path``로 지정한 폴더 안에 다음과 같은 ``forecast_results.json`` 파일이 생성됩니다.

#### JSON 출력 형식
<pre>
[
    {
        "idx": 0,
        "prediction_date": "2025-06-25",
        "region": "제주 비봉수산",
        "code": "64AF1",
        "minimum_uncertainty": 22.8,
        "prediction_temp": 23.5,
        "maximum_uncertainty": 24.2,
        "units_facility": "D"
    },
    ...
]
</pre>